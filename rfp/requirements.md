# SyncMCP 改進需求 - User Stories

> 本文件由 Vibe Coding 工作流程自動產生，基於 `user-requirements/initial-requirements.md`

## 📋 User Story Mapping

### Epic 1: 全局命令支援

**使用者故事 1.1：** 作為一個 SyncMCP 用戶，我希望能在任何目錄下執行同步指令，以便不需要每次都切換到 SyncMCP 安裝目錄。

#### 驗收標準
1. 當用戶在任意目錄執行 `syncmcp` 指令時，系統應成功啟動同步工具
2. 當用戶未在 SyncMCP 安裝目錄時，系統應能自動定位配置文件路徑
3. 當執行 `syncmcp --version` 時，系統應顯示正確的版本資訊
4. 如果 PATH 未正確設定，系統應提供清晰的安裝指引

**使用者故事 1.2：** 作為一個命令列工具用戶，我希望使用簡短易記的指令名稱（如 `syncmcp`），以便快速啟動同步工具而不需要輸入完整的 Python 路徑。

#### 驗收標準
1. 當用戶輸入 `syncmcp` 時，系統應執行同步工具
2. 當用戶輸入 `syncmcp --help` 時，系統應顯示完整的使用說明
3. 當用戶使用舊指令格式時，系統應顯示遷移提示並繼續執行
4. 如果指令不存在，系統應建議執行安裝步驟

**使用者故事 1.3：** 作為系統管理員，我希望能將 SyncMCP 安裝為系統級工具，以便團隊中的所有用戶都能使用。

#### 驗收標準
1. 當執行 `pip install -e .` 時，系統應正確安裝為可編輯模式
2. 當多個用戶執行 `syncmcp` 時，系統應各自使用其用戶配置
3. 當系統管理員更新工具時，所有用戶應能獲得更新
4. 如果權限不足，系統應提示使用 `--user` 參數安裝

### Epic 2: 文檔準確性

**使用者故事 2.1：** 作為新手用戶，我希望 README 中的指令範例是正確可執行的，以便我能順利完成首次使用而不會遇到參數錯誤。

#### 驗收標準
1. 當用戶按照 README 執行指令時，系統應成功執行而不報錯
2. 當發現文檔中的 `--yes` 參數錯誤時，應移除或修正為正確參數
3. 當 README 更新後，系統應驗證所有指令範例的正確性
4. 如果參數已變更，文檔應同步更新並標註版本

**使用者故事 2.2：** 作為文檔維護者，我希望有自動化測試來驗證文檔中的指令範例，以便確保文檔與實際代碼保持同步。

#### 驗收標準
1. 當提交代碼變更時，CI 應自動測試文檔中的指令範例
2. 當指令參數變更時，測試應檢測到文檔與代碼不一致
3. 當測試失敗時，系統應明確指出哪個指令範例有問題
4. 如果新增功能，測試應要求更新相應的文檔範例

### Epic 3: 配置可見性工具

**使用者故事 3.1：** 作為 MCP 配置管理者，我希望能查看所有客戶端的配置文件路徑，以便快速定位和檢查配置。

#### 驗收標準
1. 當執行 `syncmcp list` 或 `syncmcp status` 時，系統應顯示所有支援客戶端的配置路徑
2. 當配置文件存在時，系統應標示為「已找到」並顯示完整路徑
3. 當配置文件不存在時，系統應標示為「未找到」並建議創建
4. 如果路徑無法訪問，系統應顯示權限問題提示

**使用者故事 3.2：** 作為同步工具用戶，我希望在同步後能確認每個客戶端的 MCP 列表，以便驗證同步是否成功且沒有配置丟失。

#### 驗收標準
1. 當同步完成後，系統應顯示每個客戶端的 MCP 伺服器數量
2. 當偵測到配置丟失時，系統應明確列出丟失的 MCP 名稱
3. 當同步前後數量不一致時，系統應發出警告並要求確認
4. 如果發現不支援的 MCP（如 HTTP 類型在 Claude Desktop），系統應說明原因

**使用者故事 3.3：** 作為問題排查者，我希望能直接從命令列打開配置文件，以便快速檢視和修改配置內容。

#### 驗收標準
1. 當執行 `syncmcp open <client>` 時，系統應在預設編輯器中打開該客戶端的配置文件
2. 當未指定客戶端時，系統應顯示可選客戶端列表供用戶選擇
3. 當配置文件不存在時，系統應詢問是否創建新文件
4. 如果編輯器未設定，系統應使用系統預設編輯器（如 nano、vim）

**使用者故事 3.4：** 作為用戶，我希望看到同步前後的差異對比，以便了解哪些配置被更新或刪除。

#### 驗收標準
1. 當執行 `syncmcp diff` 時，系統應顯示同步將造成的變更
2. 當有 MCP 被新增時，系統應以綠色標示「+ MCP名稱」
3. 當有 MCP 被移除時，系統應以紅色標示「- MCP名稱」
4. 當有 MCP 配置被修改時，系統應顯示具體差異內容

### Epic 4: Terminal 互動式介面

**使用者故事 4.1：** 作為非技術背景用戶，我希望使用圖形化的選單介面來選擇同步選項，以便不需要記憶命令列參數。

#### 驗收標準
1. 當執行 `syncmcp` 不帶參數時，系統應顯示互動式選單
2. 當顯示選單時，系統應使用顏色和符號增強可讀性
3. 當選擇選項時，系統應提供即時的視覺回饋
4. 如果終端不支援互動模式，系統應退回到標準命令列模式並提示

**使用者故事 4.2：** 作為命令列工具用戶，我希望使用鍵盤上下鍵來導航選項，以便快速選擇而不需要打字。

#### 驗收標準
1. 當選單顯示時，用戶應能使用上下方向鍵移動選項
2. 當按下 Enter 鍵時，系統應執行當前選中的選項
3. 當按下數字鍵時，系統應直接選擇對應編號的選項
4. 如果選項超過一頁，系統應支援 Page Up/Down 快速導航

**使用者故事 4.3：** 作為用戶，我希望看到視覺化的進度指示器，以便了解同步操作的當前狀態。

#### 驗收標準
1. 當同步開始時，系統應顯示進度條或旋轉動畫
2. 當處理每個客戶端時，系統應更新當前處理的客戶端名稱
3. 當同步完成時，系統應顯示總計處理時間和結果摘要
4. 如果發生錯誤，進度條應停止並顯示錯誤訊息

**使用者故事 4.4：** 作為用戶，我希望能使用 ESC 鍵取消操作，以便在誤觸時能安全退出。

#### 驗收標準
1. 當在選單中按下 ESC 鍵時，系統應退出程式
2. 當在同步過程中按下 Ctrl+C 時，系統應安全中斷並詢問是否恢復
3. 當取消操作時，系統應不修改任何配置文件
4. 如果已部分完成，系統應詢問是否回滾已執行的變更

**使用者故事 4.5：** 作為用戶，我希望介面提供清晰的說明文字和提示，以便理解每個選項的作用。

#### 驗收標準
1. 當顯示選項時，每個選項應包含簡短描述
2. 當游標停留在選項上時，系統應顯示更詳細的說明
3. 當選擇危險操作（如刪除）時，系統應顯示警告訊息並要求二次確認
4. 如果有快捷鍵，系統應在選項旁標示（如「[q] 退出」）

### Epic 5: MCP Server 整合

**使用者故事 5.1：** 作為 Claude 用戶，我希望能用自然語言要求 Claude 同步 MCP 配置，以便通過對話完成配置管理。

#### 驗收標準
1. 當用戶對 Claude 說「同步 MCP 配置」時，系統應執行同步操作
2. 當同步完成時，Claude 應回報同步結果和變更摘要
3. 當發現衝突時，Claude 應詢問用戶如何處理
4. 如果同步失敗，Claude 應說明失敗原因並建議解決方法

**使用者故事 5.2：** 作為 MCP Server 開發者，我希望 SyncMCP 提供標準的 MCP 工具介面，以便與其他 MCP 客戶端無縫整合。

#### 驗收標準
1. 當 MCP Server 啟動時，系統應註冊同步相關的工具（sync、status、diff）
2. 當客戶端調用工具時，系統應返回符合 MCP 規範的結果
3. 當工具執行失敗時，系統應返回標準的錯誤格式
4. 如果 MCP Server 版本更新，系統應保持向後相容性

**使用者故事 5.3：** 作為自動化用戶，我希望 LLM 能自動偵測配置衝突並建議解決方案，以便減少手動介入。

#### 驗收標準
1. 當偵測到版本衝突時，LLM 應分析時間戳並建議使用最新版本
2. 當偵測到配置差異時，LLM 應列出差異並詢問保留哪一個
3. 當有不相容的 MCP 類型時，LLM 應說明原因並建議調整
4. 如果無法自動決策，LLM 應清楚說明需要用戶選擇的理由

**使用者故事 5.4：** 作為用戶，我希望在 Claude Code 中直接查看同步狀態和歷史記錄，以便追蹤配置變更。

#### 驗收標準
1. 當用戶請求查看狀態時，系統應顯示最近一次同步的時間和結果
2. 當查看歷史時，系統應顯示過去的同步記錄（包含時間、變更內容）
3. 當點擊歷史記錄時，系統應顯示該次同步的詳細差異
4. 如果從未同步過，系統應建議執行首次同步

### Epic 6: 錯誤處理和用戶體驗

**使用者故事 6.1：** 作為用戶，我希望在配置丟失時收到明確的警告訊息，以便及時發現和修復問題。

#### 驗收標準
1. 當同步後偵測到 MCP 數量減少時，系統應顯示紅色警告訊息
2. 當配置丟失時，系統應明確列出丟失的 MCP 伺服器名稱
3. 當詢問是否繼續時，系統應預設為「否」以避免意外數據丟失
4. 如果用戶選擇繼續，系統應在執行前創建完整備份

**使用者故事 6.2：** 作為用戶，我希望工具能自動備份配置，以便在同步失敗時能恢復。

#### 驗收標準
1. 當執行同步前，系統應自動備份所有客戶端的配置文件
2. 當備份完成時，系統應顯示備份文件的保存位置
3. 當同步失敗時，系統應提供一鍵恢復功能
4. 如果磁碟空間不足，系統應警告並詢問是否清理舊備份

**使用者故事 6.3：** 作為用戶，我希望收到友善的錯誤訊息而不是技術性的堆疊追蹤，以便理解問題並知道如何解決。

#### 驗收標準
1. 當發生錯誤時，系統應顯示簡潔的錯誤描述而非完整堆疊
2. 當錯誤可解決時，系統應提供具體的解決步驟
3. 當錯誤需要更多資訊時，系統應提示使用 `--verbose` 查看詳細日誌
4. 如果是已知問題，系統應提供相關文檔或 issue 連結

## 📊 優先級排序

### 🔴 高優先級（必須實現）
- 使用者故事 1.1, 1.2 - 全局命令支援
- 使用者故事 2.1 - 文檔準確性
- 使用者故事 3.1, 3.2 - 配置可見性
- 使用者故事 6.1, 6.2 - 錯誤處理

### 🟡 中優先級（應該實現）
- 使用者故事 4.1, 4.2, 4.3 - 互動式介面基礎
- 使用者故事 3.3 - 快速打開配置文件
- 使用者故事 5.1, 5.2 - MCP Server 基礎整合

### 🟢 低優先級（可以實現）
- 使用者故事 1.3 - 系統級安裝
- 使用者故事 2.2 - 自動化文檔測試
- 使用者故事 3.4 - 差異對比
- 使用者故事 4.4, 4.5 - 進階互動功能
- 使用者故事 5.3, 5.4 - 進階 MCP 功能
- 使用者故事 6.3 - 友善錯誤訊息

## 📈 實作路徑建議

### Phase 1: 基礎改進（立即修復）
1. 修正 README 中的 `--yes` 參數錯誤
2. 實現全局命令支援（使用 setup.py 或 pyproject.toml）
3. 加入配置路徑查看功能

### Phase 2: 用戶體驗提升
1. 實現互動式 CLI 介面
2. 加入備份和恢復機制
3. 改善錯誤訊息

### Phase 3: 進階整合
1. 開發 MCP Server
2. 整合自動化功能
3. 加入差異對比和歷史記錄
